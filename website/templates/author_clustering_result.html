{% load search_tags %}


<!DOCTYPE html>
<html>
<head>
    <!-- Standard Meta -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <!-- Site Properties -->
    <title>Crawl Status</title>
    <link rel="stylesheet" type="text/css" href="/static/semantic.min.css">

    <script src="/static/jquery-2.2.0.min.js"></script>
    <script src="/static/semantic.min.js"></script>
    <script src="/static/cytoscape.min.js"></script>

    <style type="text/css">
        body {
        background-color: #DADADA;
        }
        .column {
        max-width: 80%;
        margin:auto;
        }
        {% if graph %}
        #graph-container {
        width: 100%;
        height: 600px;
        display: block;
        }
        {% endif %}
    </style>
    <script>

    </script>
</head>
<body>

<div class="ui grid">
    <div class="column">
        <a href="/"><img class="ui fluid image" src="/static/header.png"></a>
        <div class="ui segment" style="margin:0px;">
            <div id="graph-container">
                {% if not graph %}
                <form class="ui form">
                    <select name="index_id" class="ui fluid dropdown">
                        <option value="">Select Indexed Author Set</option>
                        {% for index_name, index_data in indexes.items %}
                        {% if index_data.mappings.author %}
                        <option value="{{ index_name }}">{{ index_name }}</option>
                        {% endif %}
                        {% endfor %}
                    </select>

                    <br>
                    <input class="ui fluid green button" type="submit" value="Divide and Conquare Between Authors ...">
                </form>
                {% endif %}
            </div>
        </div>

    </div>
</div>

{% if graph %}
<script>
      $(function(){

        var cy = window.cy = cytoscape({
          container: document.getElementById('graph-container'),

          layout: {
            name: 'cose',
            idealEdgeLength: 100,
            nodeOverlap: 20
          },

          style: [{selector: 'node',style: {'content': 'data(id)'}},{"selector":"core","style":{"selection-box-color":"#AAD8FF","selection-box-border-color":"#8BB0D0","selection-box-opacity":"0.5"}},{"selector":"node","style":{"width":"mapData(score, 0, 0.006769776522008331, 20, 60)","height":"mapData(score, 0, 0.006769776522008331, 20, 60)","content":"data(name)","font-size":"12px","text-valign":"center","text-halign":"center","background-color":"#555","text-outline-color":"#555","text-outline-width":"2px","color":"#fff","overlay-padding":"6px","z-index":"10"}},{"selector":"node[?attr]","style":{"shape":"rectangle","background-color":"#aaa","text-outline-color":"#aaa","width":"16px","height":"16px","font-size":"6px","z-index":"1"}},{"selector":"node[?query]","style":{"background-clip":"none","background-fit":"contain"}},{"selector":"node:selected","style":{"border-width":"6px","border-color":"#AAD8FF","border-opacity":"0.5","background-color":"#77828C","text-outline-color":"#77828C"}},{"selector":"node.unhighlighted","style":{"opacity":"0.2"}},{"selector":"edge.unhighlighted","style":{"opacity":"0.05"}},{"selector":".highlighted","style":{"z-index":"999999"}},{"selector":"node.highlighted","style":{"border-width":"6px","border-color":"#AAD8FF","border-opacity":"0.5","background-color":"#394855","text-outline-color":"#394855","shadow-blur":"12px","shadow-color":"#000","shadow-opacity":"0.8","shadow-offset-x":"0px","shadow-offset-y":"4px"}},{"selector":"edge.filtered","style":{"opacity":"0"}},{"selector":"edge[group=\"coexp\"]","style":{"line-color":"#d0b7d5"}},{"selector":"edge[group=\"coloc\"]","style":{"line-color":"#a0b3dc"}},{"selector":"edge[group=\"gi\"]","style":{"line-color":"#90e190"}},{"selector":"edge[group=\"path\"]","style":{"line-color":"#ff0000"}},{"selector":"edge[group=\"pi\"]","style":{"line-color":"#eaa2a2"}},{"selector":"edge[group=\"predict\"]","style":{"line-color":"#f6c384"}},{"selector":"edge[group=\"spd\"]","style":{"line-color":"#dad4a2"}},{"selector":"edge[group=\"spd_attr\"]","style":{"line-color":"#D0D0D0"}},{"selector":"edge[group=\"reg\"]","style":{"line-color":"#D0D0D0"}},{"selector":"edge[group=\"reg_attr\"]","style":{"line-color":"#D0D0D0"}},{"selector":"edge[group=\"hidden\"]","style":{"line-color":"#ffffff"}}],

          elements: {
            nodes: [
              {% for node in graph.nodes %}
              { data: { id: '{{ node }}' , name: '{{ node }}@{{ cluster_map|get:node }}', classes: 'ui red label'} },
              {% endfor %}

              {% comment %}
              { data: { id: 'bar' } },

              {
                data: { weight: 100 }, // elided id => autogenerated id
                group: 'nodes',
                position: {
                  x: 100,
                  y: 100
                },
                classes: 'className1 className2',
                selected: true,
                selectable: true,
                locked: false,
                grabbable: true
              }
              {% endcomment %}
            ],

            edges: [
              {% comment %}
              { data: { id: 'baz', source: 'foo', target: 'bar'}},
              { data: { id: 'baz2', source: 'foo', target: 'bar'}},
              { data: {source: 'foo', target: 'bar'}},
              {% endcomment %}

              {% for node1 in graph.nodes %}
              {% for node2 in graph.nodes %}
              {% if cluster_map|get:node1 == cluster_map|get:node2 and node1 < node2 %}
              { data: { id: 'cluster-edge-{{node1}}-{{node2}}', source: '{{ node1 }}', target: '{{ node2 }}',group:'hidden'}},
              {% endif %}
              {% endfor %}
              {% endfor %}

              {% for edge in graph.edges %}
              { data: {weight:0, id: 'edge-{{ forloop.counter }}', source: '{{ edge.from }}', target: '{{ edge.to }}',group:'path'}},
              {% endfor %}
            ]
          },


        });
      });
</script>
{% else %}
<script>
    $('.ui.dropdown').dropdown('1');
</script>
{% endif %}
</body>

</html>
